\usepackage{listings}
\usepackage{tikz}

% add frame environment
\usepackage[%
    framemethod=tikz,
    skipbelow=\topskip,
    skipabove=\topskip
]{mdframed}

\usepackage{etoolbox}% >= v2.1 2011-01-03
\BeforeBeginEnvironment{lstlisting}{\begin{mdframed}\vspace{-0.7em}}
\AfterEndEnvironment{lstlisting}{\vspace{-0.5em}\end{mdframed}}

% needed for \lstcapt
\def\ifempty#1{\def\temparg{#1}\ifx\temparg\empty}

% make new caption command for listings
\usepackage{caption}
\newcommand{\lstcapt}[2][]{%
    \ifempty{#1}%
        \captionof{lstlisting}{#2}%
    \else%
        \captionof{lstlisting}[#1]{#2}%
    \fi%
    \vspace{0.75\baselineskip}%
}

\mdfsetup{%
    leftmargin=0pt,
    rightmargin=0pt,
    backgroundcolor=black,
    middlelinecolor=darkgray,
    roundcorner=10
}

\lstset{
    basicstyle=\fontfamily{pcr}\selectfont\footnotesize\color{white},
    keywordstyle=\color{yellow}\bfseries, % style for keywords
    numbers=none, % where to put the line-numbers
    numberstyle=\tiny, % the size of the fonts that are used for the line-numbers     
    showspaces=false, % show spaces adding particular underscores
    showstringspaces=false, % underline spaces within strings
    showtabs=false, % show tabs within strings adding particular underscores
    breaklines=true, % sets automatic line breaking
    breakatwhitespace=false, 
    language=bash, % choose the language of the code
    frame=none,
    framesep=10pt,
}