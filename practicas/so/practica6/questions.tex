\section{Conceptos teóricos}

\begin{questions}
  \question Defina \textbf{virtualización}. Investigue cuál fue una de las
  primeras implementaciones que se realizó.

  \question ¿Qué diferencia existe entre \textbf{virtualización} y
  \textbf{emulación}?

  \question Investigue el concepto de \textit{hypervisor} y responda:
  \begin{parts}

    \part ¿Qué es un \textbf{\textit{hypervisor}}? Investigue cuándo se
    realizó la primer implementación de esta tecnología.

    \part ¿Qué beneficios traen los \textit{hypervisors}? ¿Cómo se
    clasifican?

    \part Indique por qué un \textit{hypervisor} de tipo 1 no podría
    correr en una arquitectura sin tecnología de virtualización. ¿Y un
    \textit{hypervisor} de tipo 2 en hardware sin tecnología de
    virtualización?
  \end{parts}

  \question Investigue el concepto de \textbf{paravirtualización} y
  responda:
  \begin{parts}
    \part ¿Qué es la \textbf{paravirtualización}?

    \part ¿Sería posible utilizar paravirtualización en sistemas operativos
    como Windows o iOS? ¿Por qué?

    \part Mencione algún sistema que implemente paravirtualización.

    \part Defina VMI.

    \part ¿Qué beneficios trae con respecto al resto de los modos de
    virtualización?

    \part Investigue si VMI podría correr sobre \textit{hypervisors} de
    tipo 1 o 2, y justifique por qué.
  \end{parts}

  \question ¿Qué es \textit{User-mode Linux}? ¿Qué diferencias encuentra
  con el resto de las tecnologías estudiadas?

  \question Investigue sobre \textit{\textbf{containers}} en el ámbito de
  la virtualización y responda:
  \begin{parts}
    \part ¿Qué son?
    \part ¿Dependen del \textit{hardware} subyacente?
    \part ¿Qué lo diferencia por sobre el resto de las tecnologías
    estudiadas?
    \part Investigue qué funcionalidades del \textit{kernel} Linux permiten
    la implementación de \textit{containers}.
  \end{parts}

\end{questions}

\section{Ejercicios prácticos}
\textit{Se plantea el escenario donde usted es un administrador de sistemas
  que requiere ejecutar un servicio de forma aislada al resto de los
  procesos.}

\subsection{Ejecución normal}
\begin{questions}
  \question Es la forma más sencilla de ejecutar un servicio y consiste
  simplemente en correrlo como cualquier otro proceso. Ejecute el siguiente
  \textit{script} que símplemente informa al administrador datos básicos
  sobre el sistema operativo, lista el contenido del directorio
  \texttt{/home} y muestra la cantidad de procesos corriendo.
  
  \lstinputlisting[language=sh]{script.sh}

  Este sencillo \textit{script} es capaz de acceder a información del
  sistema operativo como cualquier otro servicio nativo. Esta información
  consiste en archivos y directorios sobre los cuales se tengan permisos de
  lectura, procesos en ejecución, información sobre particiones, interfaces
  de red, etc. En algunos casos suele ser conveniente restringir la
  cantidad de información a la que un proceso puede acceder.
  
\end{questions}

\subsection{chroot}
Uno de los métodos más simples para aislar servicios es \texttt{chroot},
que consiste simplemente en cambiar lo que un proceso junto con sus hijos
consideran que es el directorio raíz, limitando de esta forma lo que pueden
ver en el sistema de archivos. En esta sección de la práctica se preparará
un árbol de directorios que sirva como directorio raíz para una nueva
\textit{shell}.

\begin{questions}
  \question ¿Cuál es la finalidad de la herramienta \texttt{debootstrap}?
  Instálela en un sistema operativo basado en Debian.

  \question La sintaxis de \texttt{debootstrap} para crear un sistema base
  es: \texttt{debootstrap\ <suite>\ <target>\ <mirror>}. Utilice como
  \textit{suite} la versión estable de Debian, \texttt{stable}, como
  \textit{target} el directorio donde alojará el árbol de directorios y
  como \textit{mirror} \texttt{http://httpredir.debian.org/debian}.

  \question Para que un \texttt{chroot} funcione correctamente en Linux se
  deben montar ciertos sistemas de archivos API que necesita el sistema
  operativo.
\begin{verbatim}
# mount --bind /dev/ target/dev/
# mount --bind /proc/ target/proc/
# mount --bind /sys/ target/sys/
\end{verbatim}

  Tenga en cuenta que debe reemplazar \texttt{target/} por el directorio
  donde inicializó su \textit{debootstrap}.

  \question Copie el \textit{script} que ejecutó en la sección anterior a
  un directorio accesible desde el \texttt{chroot}. Por ejemplo,
  \texttt{target/bin/script.sh}.

  \question Ejecute una \textit{shell} cuyo directorio raíz sea
  \texttt{target/}. Para tal fin, utilice con privilegios de \texttt{root}
  el comando \texttt{chroot}.

  \question Ejecute el \textit{script} instalado previamente y analice los
  resultados. ¿Puede ver los procesos que corren en el sistema operativo
  base? ¿Por qué?

  \question ¿Qué desventajas encuentra en el uso de \texttt{chroot} como
  medida de seguridad?

\end{questions}

\subsection{Containers}

\textit{En GNU/Linux hay varias implementaciones de la tecnología de
  containers que provee el kernel. En esta sección de la práctica
  estudiaremos una de las primeras, \textbf{LXC (Linux Containers)}.}

\begin{questions}
\question ¿En qué se diferencia la virtualización tipo VirtualBox de los \textit{containers}?
\question Ejercicio guiado:

\begin{parts}
  \part Instale LXC mediante el comando:
  \begin{verbatim}
apt-get install lxc
  \end{verbatim}
  \part Compruebe mediante el siguiente comando si su \textit{kernel} soporta
  LXC:
  \begin{verbatim}
lxc-checkconfig
\end{verbatim}
  \textbf{Nota}: puede que no todas las opciones estén habilitadas

  \part Compruebe los \textit{templates} que dispone (a partir de donde se
  crean los \textit{containers}):
  \begin{verbatim}
ls /usr/share/lxc/templates
  \end{verbatim}
  
  \part Cree un nuevo \textit{container} desde el \textit{template} de Debian
  con el nombre \texttt{sodebian}:
  \begin{verbatim}
lxc-create -t debian -n sodebian
  \end{verbatim}
  \textbf{Nota}: durante la instalación se muestra el usuario y la
  contraseña utilizados para ingresar al \textit{container}. Este comando
  puede demorar varios minutos la primera vez que es ejecutado ya que debe
  descargar muchos componentes.
  
  \part Una vez creado el \textit{container} inícielo mediante el siguiente
  comando:
  \begin{verbatim}
lxc-start -n sodebian -d
  \end{verbatim}
  \textbf{Nota}: \texttt{-n} para ingresar el nombre del container que
  queremos iniciar, \texttt{-d} para que corra como \textit{daemon}.
  
  \part Utilice el comando \texttt{lxc-list} para comprobar el estado de
  los \textit{containers}. ¿En qué estado se encuentra el
  \textit{container} \texttt{sodebian}?
  
  \part Mediante el siguiente comando ingrese al \textit{container} y
  ejecute el \textit{script} utilizado en los ejercicios anteriores.
  \begin{verbatim}
lxc-console -n sodebian
  \end{verbatim}

  \begin{parts}
    \part ¿Puede acceder al \texttt{/home} del sistema operativo base?
    \part ¿Puede ver los procesos que están corriendo en el sistema
    operativo base?
  \end{parts}
  
  \part Clone un \textit{container} utilizando el comando
  \texttt{lxc-clone}.

  \part Vuelva a ejecutar \textit{lxc-list} y analice su salida.

  \part Detenga el \textit{container} \texttt{sodebian}.
  \begin{verbatim}
lxc-shutdown -n sodebian
\end{verbatim}

  \part Edite el archivo \texttt{/var/lib/lxc/sodebian/config} y modifique
  la dirección MAC del \textit{container}. 
 
  \part Elimine definitivamente el \textit{container} mediante el comando:
  \begin{verbatim}
lxc-destroy -n sodebian
  \end{verbatim}  
\end{parts}
\end{questions}